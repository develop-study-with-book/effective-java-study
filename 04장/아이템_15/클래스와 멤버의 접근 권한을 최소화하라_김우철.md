## 아이템 15. 클래스와 멤버의 접근 권한을 최소화하라

### 잘 설계된 컴포넌트

- 잘 설계된 컴포넌트란 '클래스 내부 데이터와 내부 구현 정보를 외부 컴포넌트로부터 얼마나 잘 숨겼는가'가 포인트
- 구현과 API를 깔끔하게 분리해야 한다
  - 정보은닉 / 캡슐화는 소프트웨어 설계의 근간이 되는 원리다.

### 정보 은닉의 장점
- 시스템 개발 속도 향상
  - 여러 컴포넌트를 병렬로 개발
- 시스템 관리 비용 절약
  - 컴포넌트 이해도가 높아져 빠르게 디버깅할 수 있고, 컴포넌트 교체 부담도 적다.
- 성능 최적화에 도움
  - 성능의 병목 지점을 찾는데 용이
  - 필요시 특정 컴포넌트만 최적화 하고 다른 컴포넌트에 영향을 주지 않음
- 소프트웨어 재사용성 증가
  - 의존성이 낮은 컴포넌트라면 다른 환경에서도 유용하게 쓰일 가능성이 높음
- 큰 시스템을 제작하는 난이도를 낮춰줌
  - Divide And Conquer 전략(분할정복)
  - 개별 컴포넌트의 동작을 검증 가능
  - 잘개 쪼개서 하나씩 개발 하다보면 구색을 갖춤

### 접근 제한자 활용
- 정보 은닉의 핵심은 접근 제한자를 제대로 활용하는 것이다.
- 모든 클래스와 멤버의 접근성을 가능한 한 좁혀야 한다.

### 톱 레벨의 범위
- 톱레벨(가장 바깥) 클래스와 인터페이스에 부여할 수 있는 접근 수준은 package-private(default)와 public 두가지 이다.
- 패키지 외부에서 쓸 이유가 없다면 package-private으로 선언하자.
- public으로 사용하는 순간부터 공개 API가 되어 하위 호환성을 유지해야 한다.
  - 클라이언트가 어디서 어떻게 사용하는지 모르기 때문이다.
  - 버저닝만 잘한다면 하위 호환성을 깨뜨려도 문제없지 않을까란 생각

### private static 중첩 클래스 (Static Nested Class)
- 한 클래스에서만 사용하는 package-private 톱레벨 클래스나 인터페이스는 이를 사용하는 클래스 안에 private static으로 중첩시켜보자.
- public일 필요가 없는 클래스의 접근 수준을 package-private 톱레벨 클래스로 좁히는 일이다.
  - public 클래스는 그 패키지의 API인 반면, package-private 톱레벨 클래스는 내부 구현에 속하기 때문이다.
  ```java
  // TO-DO
  public class A{
  private int a;
  
      private static class B{ // B가 A에서만 쓰이는 클래스
          private int b;
      }
  }
  ```
- private static인 이유
  - private class는 자기 자신을 감싸고 있는 외부 인스턴스를 참조한다
    - 코드상으로 없더라도 자동으로 만들어진다. 
    - 계속 참조하고 있기 때문에 사용하지 않는 클래스라도 메모리를 회수하지 못한다.


### 멤버 접근 수준 4가지
- private: 해당 클래스에서만 접근 가능
- package-private: 클래스와 같은 패키지에서 접근 가능
- protected: 같은 패키지 + 하위 클래스의 패키지에서 접근 가능
- public: 모든 곳에서 접근 가능

### 권한 풀어주기
- 권한을 풀어주는 일이 지나치게 많아지면 컴포넌트를 더 분리해야 하는것이 아닌지 고민해야 한다.

### 멤버와 공개 API
- private과 package-private 멤버가 Serializable을 구현한 클래스에서는 그 필드들도 의도치 않게 공개 API가 될 수도 있다.
  - 직렬화란 Java 시스템 내부에서 사용되는 Object나 Data를 외부에서도 사용할 수 있도록 byte 형태로 변환하는 기술
  - 클래스의 객체가 직렬화되어 파일에 저장되면, 필드들의 값도 직렬화 대상에 포함되고, 나중에 역직렬화를 통해 값을 읽을 수도 있다.
  - 해결방법
    - transient 키워드 사용헤여 직렬화 대상에서 제외
    - Externalizable 인터페이스 직접 구현하여 직렬화 역직렬화 방법 제어
    - writeObject, readObject 메서드 구현

### 멤버 접근성의 제약
- public 클래스의 멤버 접근 수준을 protected로 되도록 변경하지 말자
  - 멤버에 접근할 수 있는 대상 범위가 엄청나게 넓어진다.
- 리스코프 치환 원칙에 의해 상위 클래스의 메서드를 재정의하는 경우, 그 접근 수준을 상위 클래스보다 좁게 설정할 수 없다.
  - 규칙을 어기면 컴파일 오류가 발생한다.
  - 리스코프 치환 원칙이란 상위 타입의 객체를 하위 타입의 객체로 치환해도 동작에 문제가 없어야 하는 규칙이다.
- class가 인터페이스를 구현하는건 특별한 예외로, class의 메서드는 모두 public으로 선언해야 한다.

### 주의사항
- 테스트 목적으로 접근 범위를 넓히면 안된다.
  - private 멤버를 protected, public 까지 푸는건 문제가 있다.
  - 클래스의 구조나 설계를 의심해봐야 한다.
  - 참고로 테스트 코드는 테스트 대상과 같은 패키지에 두면 package-private 요소에 접근할 수 있다.
  - 테스트 작성 때문에 불필요한 public 메서드를 만들지 말자.
- public 클래스의 인스턴스 필드는 되도록 public이면 안된다.
  - publci이면 필드가 언제든지 가변될 수 있다.
  - public final로 한다해도, 배열이나 List 같은 경우 내부 값의 변경 여지가 있다.
  - 컬렉션 등의 값을 외부로 전달시 불변으로 전달하면 값의 변경을 막을 수 있다.
  ```java
  // 배열
  Collections.unmodifiableList(Arrays.asList(배열));
  혹은
  배열.clone();
  
  // 리스트
  Collections.unmodifiableList(리스트);
  ```
- 상수는 public static final 필드로 공개해도 좋다.

### 자바9와 모듈 시스템
- 자바9에서는 모듈 시스템이라는 개념이 도입되었다.
- 모듈은 패키지들의 묶음인데, 모듈에 속하는 패키지 중 공개(export)할 것을 선언하는 파일이 생성되었다 (info.java)
- 이 파일에 존재하지 않는 패키지라면, public, protected 멤버라도 모듈 외부에서 접근이 불가능하다.
- 다른 모듈에서는 접근할 수 없으나 같은 모듈이라면 패키지가 달라도 접근할 수 있는 접근 제어자가 생긴 것이다.
- 자바 라이브러리에서 공개하지 않은 패키지들은 해당 모듈 밖에서 접근이 불가능하다.

